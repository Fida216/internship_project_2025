<form [formGroup]="campaignForm" (ngSubmit)="onSubmit()" class="campaign-form">
    <h1 mat-dialog-title>{{ isEditMode ? 'Edit' : 'Create' }} Marketing Campaign</h1>

    <mat-dialog-content class="form-content">
        <div class="form-grid">
            <!-- Title -->
            <mat-form-field appearance="fill" class="full-width">
                <mat-label>Title</mat-label>
                <input matInput formControlName="title" required>
                <mat-error *ngIf="campaignForm.get('title')?.hasError('required')">
                    Title is required
                </mat-error>
            </mat-form-field>

            <!-- Description -->
            <mat-form-field appearance="fill" class="full-width">
                <mat-label>Description</mat-label>
                <textarea matInput formControlName="description" rows="3" required></textarea>
                <mat-error *ngIf="campaignForm.get('description')?.hasError('required')">
                    Description is required
                </mat-error>
            </mat-form-field>

            <!-- Status -->
            <mat-form-field appearance="fill">
                <mat-label>Status</mat-label>
                <mat-select formControlName="status" required>
                    <mat-option *ngFor="let status of statusOptions" [value]="status.value">
                        {{ status.label }}
                    </mat-option>
                </mat-select>
                <mat-error *ngIf="campaignForm.get('status')?.hasError('required')">
                    Status is required
                </mat-error>
            </mat-form-field>

            <!-- Start Date -->
            <mat-form-field appearance="fill">
                <mat-label>Start Date</mat-label>
                <input matInput [matDatepicker]="startPicker" formControlName="startDate" required>
                <mat-datepicker-toggle matSuffix [for]="startPicker"></mat-datepicker-toggle>
                <mat-datepicker #startPicker></mat-datepicker>
                <mat-error *ngIf="campaignForm.get('startDate')?.hasError('required')">
                    Start date is required
                </mat-error>
            </mat-form-field>

            <!-- End Date -->
            <mat-form-field appearance="fill">
                <mat-label>End Date</mat-label>
                <input matInput [matDatepicker]="endPicker" formControlName="endDate" required>
                <mat-datepicker-toggle matSuffix [for]="endPicker"></mat-datepicker-toggle>
                <mat-datepicker #endPicker></mat-datepicker>
                <mat-error *ngIf="campaignForm.get('endDate')?.hasError('required')">
                    End date is required
                </mat-error>
            </mat-form-field>

            <!-- Target Clients -->
            <mat-form-field appearance="fill" class="full-width">
                <mat-label>Target Clients</mat-label>
                <mat-select formControlName="targets" multiple [compareWith]="compareClients">
                    <mat-option *ngFor="let client of clients" [value]="client">
                        {{ client.firstName }} {{ client.lastName }} - {{ client.email }}
                    </mat-option>
                </mat-select>
            </mat-form-field>
        </div>

        <!-- Selected Clients Preview -->
        <div class="selected-clients-preview" *ngIf="selectedClients.length > 0">
            <h3>Selected Clients ({{ selectedClients.length }})</h3>
            <div class="clients-chips">
                <mat-chip *ngFor="let client of selectedClients" [disabled]="true" [removable]="true"
                    (removed)="removeClient(client)">
                    {{ client.firstName }} {{ client.lastName }}
                    <mat-icon matChipRemove>cancel</mat-icon>
                </mat-chip>
            </div>
        </div>
    </mat-dialog-content>

    <mat-dialog-actions align="end">
        <button mat-button type="button" (click)="onCancel()">Cancel</button>
        <button mat-raised-button color="primary" type="submit" [disabled]="campaignForm.invalid || isLoading">
            <span *ngIf="!isLoading">{{ isEditMode ? 'Update' : 'Create' }} Campaign</span>
            <mat-progress-spinner *ngIf="isLoading" diameter="20" mode="indeterminate"
                color="accent"></mat-progress-spinner>
        </button>
    </mat-dialog-actions>
</form>